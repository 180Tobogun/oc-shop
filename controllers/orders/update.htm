<?php Block::put('breadcrumb') ?>
    <ul>
        <li><a href="<?= Backend::url('dshoreman/shop/orders') ?>">Orders</a></li>
        <li><?= e($this->pageTitle) ?></li>
    </ul>
<?php Block::endPut() ?>
<?php if (!$this->fatalError): ?>


    <?php Block::put('form-contents') ?>
    <div class="layout">
        <div class="layout-row">

            <div class="scoreboard">
                <div data-controls="toolbar">
                    <div class="scoreboard-item title-value">
                        <h4>Order #</h4>
                        <p><?= $formModel->id ?></p>
                    </div>
                    <div class="scoreboard-item title-value">
                        <h4>Customer</h4>
                        <p class="oc-icon-user">
                            <?= $formModel->billing_name ?>
                        </p>
                        <p class="description">
                            Email: <?= $formModel->email ?>
                        </p>
                    </div>
                    <div class="scoreboard-item title-value">
                        <h4>Current Status</h4>
                        <?= $formModel->is_paid
                         ? '<p style="color: #95b753;">Paid</p>'
                         : '<p style="color: #cb2d00;">Pending</p>'
                        ?>
                        <p class="description"></p>
                    </div>
                    <div class="scoreboard-item title-value">
                        <h4>Total Value</h4>
                        <p style="color: #95b753;">
                            &pound;<?= $formModel->total ?>
                        </p>
                        <p class="description">
                            for <?= $itemCount ?> items
                        </p>
                    </div>
                    <div class="scoreboard-item title-value">
                        <h4>Date Placed</h4>
                        <p><?= $formModel->created_at->format("H:i d/m/Y") ?></p>
                        <p class="description">
                            Updated <?= $formModel->updated_at->format("H:i d/m/Y") ?>
                        </p>
                    </div>
                </div>
            </div>

            <div class="hide-tabs"><?= $this->formRenderPrimaryTabs() ?></div>

        </div>

        <div class="form-buttons layout-item fix">
            <div class="loading-indicator-container">
                <button
                    type="submit"
                    data-request="onSave"
                    data-request-data="redirect:0"
                    data-hotkey="ctrl+s, cmd+s"
                    data-load-indicator="Saving Order..."
                    class="btn btn-primary">
                    <u>S</u>ave
                </button>
                <button
                    type="button"
                    data-request="onSave"
                    data-request-data="close:1"
                    data-hotkey="ctrl+enter, cmd+enter"
                    data-load-indicator="Saving Order..."
                    class="btn btn-default">
                    Save and Close
                </button>
                <button
                    type="button"
                    class="oc-icon-trash-o btn-icon danger pull-right"
                    data-request="onDelete"
                    data-load-indicator="Deleting Order..."
                    data-request-confirm="Do you really want to delete this order?">
                </button>
                <span class="btn-text">
                    or <a href="<?= Backend::url('dshoreman/shop/orders') ?>">Cancel</a>
                </span>
            </div>
        </div>
        <div style="height: 300px;"></div>
    </div>
    <?php Block::endPut() ?>

    <?php Block::put('form-sidebar') ?>
        <div class="panel panel-default">
            <h4>Billing Address
                <div class="pull-right">
                    <button type="button"
                            class="btn btn-warning btn-xs addr-modal"
                            data-toggle="modal"
                            data-target="#addrEditModal"
                            data-addr_type="billing">
                        <i class="oc-icon oc-icon-pencil"></i> Edit
                    </button>
                </div>
            </h4>
            <address data-type="billing">
                <span data-line="name"><?= $formModel->billing_name ?></span><br>
                <span data-line="street"><?= $formModel->billing_street ?></span><br>
                <span data-line="town"><?= $formModel->billing_town ?></span><br>
                <span data-line="county"><?= $formModel->billing_county ?></span><br>
                <span data-line="postcode"><?= $formModel->billing_postcode ?></span><br>
                <span data-line="country"><?= $formModel->billing_country ?></span><br>
            </address>
        </div>
        <div class="panel panel-default">
            <h4>Shipping Address
                <div class="pull-right">
                    <button type="button"
                            class="btn btn-warning btn-xs addr-modal"
                            data-toggle="modal"
                            data-target="#addrEditModal"
                            data-addr_type="shipping">
                        <i class="oc-icon oc-icon-pencil"></i> Edit
                    </button>
                </div>
            </h4>
            <address data-type="shipping">
                <span data-line="name"><?= $formModel->shipping_name ?></span><br>
                <span data-line="street"><?= $formModel->shipping_street ?></span><br>
                <span data-line="town"><?= $formModel->shipping_town ?></span><br>
                <span data-line="county"><?= $formModel->shipping_county ?></span><br>
                <span data-line="postcode"><?= $formModel->shipping_postcode ?></span><br>
                <span data-line="country"><?= $formModel->shiping_country ?></span><br>
            </address>
        </div>

        <div class="modal fade" id="addrEditModal" tabindex="-1" role="dialog" aria-labelledby="addrEditModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="addrEditModalLabel">Editing Address</h4>
                    </div>
                    <div class="modal-body" id="addrModalForm">
                        <div class="form-group">
                            <label for="addr-name" class="control-label">Full Name:</label>
                            <input type="text" class="form-control" id="addr-name">
                        </div>
                        <div class="form-group">
                            <label for="addr-street" class="control-label">Address Line 1:</label>
                            <input type="text" class="form-control" id="addr-street">
                        </div>
                        <div class="form-group">
                            <label for="addr-street" class="control-label">Town:</label>
                            <input type="text" class="form-control" id="addr-town">
                        </div>
                        <div class="form-group">
                            <label for="addr-county" class="control-label">County:</label>
                            <input type="text" class="form-control" id="addr-county">
                        </div>
                        <div class="form-group">
                            <label for="addr-postcode" class="control-label">Post Code:</label>
                            <input type="text" class="form-control" id="addr-postcode">
                        </div>
                        <div class="form-group">
                            <label for="addr-country" class="control-label">Country:</label>
                            <input type="text" class="form-control" id="addr-country">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="saveAddrBtn">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            $(window).ready(function() {

                $('#addrEditModal').on('show.bs.modal', function (e) {
                    var button = $(e.relatedTarget),
                        addrtype = button.data('addr_type'),
                        addr = $('address[data-type="'+addrtype+'"]'),
                        modal = $(this);

                    modal.find('.modal-title').text("Updating address '"+addrtype+"'");
                    setModalClass(addrtype);

                    $('#addr-name').val(addr.find('span[data-line="name"]').text());
                    $('#addr-street').val(addr.find('span[data-line="street"]').text());
                    $('#addr-town').val(addr.find('span[data-line="town"]').text());
                    $('#addr-county').val(addr.find('span[data-line="county"]').text());
                    $('#addr-postcode').val(addr.find('span[data-line="postcode"]').text());
                    $('#addr-country').val(addr.find('span[data-line="country"]').text());
                });

                function setModalClass(type) {
                    $('#addrModalForm').removeClass('billing');
                    $('#addrModalForm').removeClass('shipping');

                    $('#addrModalForm').addClass(type);
                }

                $('#saveAddrBtn').on('click', function() {
                    var a = new Object(),
                        at= $('#addrModalForm').hasClass('billing') ? 'billing' : 'shipping';

                    a.name = $('#addr-name').val();
                    a.street = $('#addr-street').val();
                    a.town = $('#addr-town').val();
                    a.county = $('#addr-county').val();
                    a.postcode = $('#addr-postcode').val();
                    a.country = $('#addr-country').val();

                    $.each(a, function(line, val) {
                        addr = $('address[data-type="'+at+'"]');
                        addr.find('span[data-line="'+line+'"]').text(val);

                        $('#Form-field-Order-'+at+'_'+line).val(val);
                    });

                    $('#addrEditModal').modal('hide');
                });

            });
        </script>
    <?php Block::endPut() ?>

    <?php Block::put('body') ?>
        <?= Form::open(['class' => 'layout-stretch']) ?>
            <?= $this->makeLayout('form-with-sidebar') ?>
        <?= Form::close() ?>
    <?php Block::endPut() ?>

<?php else: ?>


    <p class="flash-message static error"><?= e($this->fatalError) ?></p>
    <p><a href="<?= Backend::url('dshoreman/shop/orders') ?>" class="btn btn-default">Return to orders list</a></p>
<?php endif ?>
